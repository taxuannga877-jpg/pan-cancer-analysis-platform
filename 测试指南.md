# 🧪 测试指南 - v2.1.0

## 快速验证所有修复

---

## 📋 测试前准备

### 1. 安装新依赖包
```r
# 在R控制台中运行
source("scripts/install_new_packages.R")
```

### 2. 启动应用
```r
shiny::runApp('src/cancer_analysis_app.R', host='0.0.0.0', port=3838)
```

### 3. 打开浏览器
访问: `http://localhost:3838`

---

## ✅ 测试清单

### 测试1: 验证12种模型都可用 ✓
**步骤**:
1. 进入"高级模型训练"页面
2. 查看"选择机器学习算法"选项

**预期结果**:
应该看到12个选项:
- [x] Logistic Regression
- [x] Lasso
- [x] Ridge
- [x] Elastic Net
- [x] Random Forest
- [x] GBM
- [x] XGBoost
- [x] SVM-Radial
- [x] SVM-Linear ⭐ (新)
- [x] Neural Network ⭐ (新)
- [x] Naive Bayes ⭐ (新)
- [x] K-Nearest Neighbors ⭐ (新)

---

### 测试2: 验证训练进度显示 ✓
**步骤**:
1. 点击"加载示例数据（肝癌）"
2. 选择2-3个模型（如: Logistic, RandomForest, XGBoost）
3. 设置:
   - 交叉验证: 5折
   - 启用贝叶斯优化: ✓
   - 迭代次数: 3
4. 点击"开始训练模型"
5. 观察"训练进度与结果"框中的输出

**预期结果**:
控制台应显示类似:
```
========================================
开始训练 3 个模型
交叉验证方法: 5 折交叉验证
贝叶斯优化: 启用 (迭代次数: 3)
========================================

[ 1 / 3 ] 开始训练: Logistic
预计时间: 5 折
✓ 完成训练: Logistic | 用时: 2.3 秒
  - CV AUC: 0.8234 | Test AUC: 0.8156 | 过拟合差: 0.0078

[ 2 / 3 ] 开始训练: RandomForest
预计时间: 5 折
贝叶斯优化: RandomForest - 初始化参数搜索
✓ 完成训练: RandomForest | 用时: 12.5 秒
  - CV AUC: 0.8534 | Test AUC: 0.8421 | 过拟合差: 0.0113
```

---

### 测试3: 验证ROC曲线显示 ✓
**步骤**:
1. 训练完成后，切换到"模型评估"页面
2. 查看"ROC曲线对比"图表

**预期结果**:
- ✓ 应该看到彩色的ROC曲线
- ✓ 每条曲线有不同颜色
- ✓ 图例显示模型名称和AUC值
- ✓ 有一条灰色虚线表示随机猜测
- ✓ 鼠标悬停显示详细信息

**如果失败**:
- 检查控制台是否有错误信息
- 确认所有模型都训练成功
- 刷新页面重试

---

### 测试4: 验证过拟合改善 ✓
**步骤**:
1. 训练 RandomForest 和 GBM
2. 查看"交叉验证性能表"

**预期结果**:
- RandomForest: |过拟合差| < 0.10 ✓
- GBM: |过拟合差| < 0.10 ✓
- 如果过拟合差 > 0.10，会显示红色背景 ⚠️

**对比之前**:
- 之前: 过拟合差可能 > 0.15
- 现在: 过拟合差应该 < 0.10

---

### 测试5: 验证SVM正常工作 ✓
**步骤**:
1. 选择 SVM-Radial 和 SVM-Linear
2. 点击"开始训练模型"
3. 观察训练进度

**预期结果**:
- ✓ 应显示"训练 SVM-Radial (可能需要较长时间)..."
- ✓ 应显示"训练 SVM-Linear..."
- ✓ 训练应该成功完成（10-20秒）
- ✓ 在性能表中看到SVM的结果
- ✓ ROC曲线中看到SVM的曲线

**如果失败**:
检查是否安装了 `e1071` 包

---

### 测试6: 验证动态模型选择 ✓
**步骤**:
1. 先不训练任何模型
2. 切换到"预测分析"页面
3. 查看"选择预测模型"下拉菜单 → 应为空或显示"NULL"
4. 返回"高级模型训练"页面
5. 训练3个模型（如: Logistic, RandomForest, NeuralNet）
6. 训练完成后，再次查看"预测分析"页面

**预期结果**:
- ✓ 训练前: 模型选择为空
- ✓ 训练后: 只显示已训练的3个模型
- ✓ 默认选择性能最好的模型
- ✓ 不会显示未训练的模型

---

### 测试7: 验证新模型预测功能 ✓
**步骤**:
1. 训练 Neural Network 或 KNN
2. 切换到"预测分析"页面
3. 输入特征值（或使用默认值）
4. 选择训练好的模型
5. 点击"进行预测"

**预期结果**:
- ✓ 应该成功返回预测结果
- ✓ 显示预测概率
- ✓ 显示预测类别（良性/恶性）
- ✓ 显示模型性能（CV AUC, Test AUC）
- ✓ 不会报错

---

### 测试8: 验证K折交叉验证真实运行 ✓
**步骤**:
1. 选择1个模型
2. 设置K折 = 10（较大值）
3. 观察训练时间

**验证方法**:
- ✓ 训练时间应该明显增加（10折 vs 5折）
- ✓ 控制台显示"10 折交叉验证"
- ✓ CV AUC 应该与 Test AUC 接近
- ✓ 在"学习曲线"中可以看到多个数据点

---

### 测试9: 验证贝叶斯优化真实运行 ✓
**步骤**:
1. 选择 RandomForest
2. 启用贝叶斯优化
3. 设置迭代次数 = 3
4. 训练模型
5. 再次训练（第二轮）

**预期结果**:
- 第一轮: 显示"初始化参数搜索"
- 第二轮: 显示"基于历史最佳参数进行微调"
- ✓ 控制台显示参数更新信息
- ✓ 显示当前最佳参数和ROC
- ✓ 第二轮搜索空间更小（微调）

---

### 测试10: 全面压力测试 ✓
**步骤**:
1. 选择所有12个模型
2. 设置:
   - K折: 5
   - 重复次数: 2（如果选择repeatedcv）
   - 贝叶斯优化: 启用
   - 迭代: 3
3. 点击"开始训练模型"
4. 等待完成（可能需要5-10分钟）

**预期结果**:
- ✓ 所有12个模型都能成功训练
- ✓ ROC曲线显示12条曲线
- ✓ 性能表显示12行数据
- ✓ 可以查看每个模型的可解释性
- ✓ 预测页面可以选择任一模型

---

## 🎯 性能基准参考

在示例数据上（3216条记录，12特征）:

| 模型 | 预期训练时间 | 预期CV AUC |
|------|------------|-----------|
| Logistic | 2-3秒 | 0.82-0.84 |
| Lasso/Ridge | 3-5秒 | 0.82-0.85 |
| Naive Bayes | 1-2秒 | 0.78-0.82 |
| KNN | 3-5秒 | 0.80-0.84 |
| Random Forest | 10-15秒 | 0.84-0.87 |
| GBM | 12-18秒 | 0.83-0.86 |
| XGBoost | 8-12秒 | 0.85-0.88 |
| SVM-Linear | 5-8秒 | 0.82-0.85 |
| SVM-Radial | 15-25秒 | 0.82-0.86 |
| Neural Network | 8-12秒 | 0.82-0.85 |

---

## ❌ 常见问题排查

### 问题1: 包安装失败
**解决**:
```r
install.packages("包名", dependencies = TRUE, repos = "https://cloud.r-project.org/")
```

### 问题2: ROC曲线空白
**检查**:
- 确认模型训练成功
- 查看控制台错误信息
- 确认测试集有数据

### 问题3: SVM训练很慢
**说明**: 
- SVM-Radial 对大数据集确实较慢
- 这是正常现象
- 可以先用较小数据测试

### 问题4: 内存不足
**解决**:
- 减少选择的模型数量
- 减少K折数量
- 减少贝叶斯迭代次数

---

## ✨ 成功标志

如果看到以下情况，说明修复成功:

1. ✅ 12个模型都可选择
2. ✅ 训练进度实时显示，包含用时
3. ✅ ROC曲线彩色显示，12条曲线
4. ✅ 过拟合差 < 0.10
5. ✅ SVM训练成功完成
6. ✅ 预测页面只显示已训练模型
7. ✅ 控制台显示K折和贝叶斯优化过程

---

## 📝 测试报告模板

```
测试日期: ______
测试人: ______

[ ] 测试1: 12种模型可用
[ ] 测试2: 训练进度显示
[ ] 测试3: ROC曲线显示
[ ] 测试4: 过拟合改善
[ ] 测试5: SVM正常工作
[ ] 测试6: 动态模型选择
[ ] 测试7: 新模型预测
[ ] 测试8: K折验证
[ ] 测试9: 贝叶斯优化
[ ] 测试10: 全面压力测试

备注:
________________________
________________________
```

---

祝测试顺利！🎉

