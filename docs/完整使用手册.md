# 🚀 肝癌数据分析平台 - 高级版快速参考

## 📌 一分钟快速开始

```bash
# 1. 启动应用
cd /root/SurvivalML
R -e "shiny::runApp('liver_cancer_advanced_app.R', host='0.0.0.0', port=3838)"

# 2. 访问
# 浏览器打开: http://localhost:3838

# 3. 停止
pkill -f "shiny::runApp"
```

---

## ✨ 核心新功能 (7大升级)

| 功能 | 说明 | 状态 |
|------|------|------|
| 🎯 **自定义目标列** | 支持任意列名 (Target/liver_cancer/label等) | ✅ |
| 📊 **K折交叉验证** | 3种方法: K折/重复K折/留一法 | ✅ |
| 🔧 **贝叶斯优化** | 自动超参数调优 | ✅ |
| 💾 **模型管理** | 保存/加载/查看模型 | ✅ |
| ⚠️ **过拟合检测** | 实时监控+评级 | ✅ |
| 💡 **SHAP分析** | 深度可解释性 | ✅ |
| 🚀 **XGBoost** | 第8种算法 | ✅ |

---

## 🔥 关键特性对比

| 项目 | 基础版 | 高级版 |
|------|--------|--------|
| 算法数量 | 7种 | **8种** (+XGBoost) |
| 目标列 | 仅Target | **任意名称** |
| 交叉验证 | ❌ | **✅ 3种** |
| 超参数优化 | ❌ | **✅ 贝叶斯** |
| 过拟合检测 | ❌ | **✅ 实时** |
| 模型保存 | ❌ | **✅ 完整** |
| 可解释性 | 基础 | **✅ SHAP** |

---

## 📊 支持的8种算法

1. **Logistic Regression** - 逻辑回归
2. **Lasso** - L1正则化
3. **Ridge** - L2正则化
4. **Elastic Net** - 弹性网络
5. **Random Forest** - 随机森林 ⭐推荐
6. **GBM** - 梯度提升
7. **XGBoost** - 极端梯度提升 ⭐推荐 NEW!
8. **SVM** - 支持向量机

---

## 🎯 自定义目标列使用

### 支持的列名示例
```
✅ Target          # 传统命名
✅ liver_cancer    # 疾病名称
✅ diagnosis       # 诊断结果
✅ label           # 标签
✅ outcome         # 结果
✅ class           # 类别
✅ 任意英文列名
```

### 使用步骤
1. 加载数据后，进入 **数据概览** 页面
2. 找到 **"目标列设置"** 区域
3. 从下拉菜单选择您的目标列
4. 系统自动更新所有分析

---

## 📈 交叉验证配置

### K折交叉验证 (推荐)
- **折数**: 3-10 (推荐5折)
- **用途**: 快速评估
- **适用**: 中小数据集

### 重复K折
- **折数**: 3-10
- **重复**: 2-10次 (推荐3次)
- **用途**: 稳定评估
- **适用**: 需要精确评估

### 留一法 (LOOCV)
- **用途**: 最大化训练数据
- **适用**: 小数据集 (<500样本)
- **缺点**: 计算慢

---

## 🔧 贝叶斯优化

### 何时启用?
- ✅ 数据集 > 1000 样本
- ✅ 需要最佳性能
- ✅ 有充足计算时间

### 配置参数
- **迭代次数**: 5-50
- **推荐**: 10-20次
- **注意**: 增加训练时间

---

## 💾 模型管理

### 保存模型
```
路径: ./saved_models/
格式: model_name_YYYYMMDD_HHMMSS.rds
内容: 模型 + 性能 + 元数据
```

### 加载模型
1. 进入 **模型管理** 页面
2. 点击 **刷新列表**
3. 选择模型 → **加载模型**
4. 可在预测中使用

---

## ⚠️ 过拟合检测

### 评级标准
- **🟢 低过拟合**: CV与Test AUC差距 < 0.05
- **🟡 中等过拟合**: 差距 0.05-0.1
- **🔴 高过拟合**: 差距 > 0.1

### 防止策略
1. 使用交叉验证
2. 启用正则化
3. 减少模型复杂度
4. 增加训练数据

---

## 💡 SHAP可解释性

### 功能列表
- ✅ 特征重要性排序
- ✅ SHAP摘要图
- ✅ 特征依赖图
- ✅ 部分依赖图 (PDP)
- ✅ 单样本解释

### 使用步骤
1. 训练模型完成后
2. 进入 **可解释性分析** 页面
3. 选择模型 → **计算SHAP值**
4. 查看多维度分析结果

---

## 📝 数据格式要求

### CSV文件标准
```csv
feature1,feature2,feature3,...,your_target_column
1.23,4.56,7.89,...,0
2.34,5.67,8.90,...,1
3.45,6.78,9.01,...,0
```

### 必需条件
- ✅ 第一行为列名
- ✅ 特征列为数值型
- ✅ 目标列为 0/1 二分类
- ✅ 无缺失值
- ✅ 推荐样本数 > 100

---

## 🎓 7步完整工作流程

### 1️⃣ 数据加载
- 上传CSV文件
- 或加载默认数据
- **选择目标列** ⭐新功能

### 2️⃣ 特征分析
- 查看相关性热图
- 分析特征分布
- 识别异常值

### 3️⃣ 模型训练
- 设置训练集比例 (0.7-0.8)
- 选择交叉验证方法
- 启用贝叶斯优化 (可选)
- 选择算法 (推荐RF+XGBoost)
- 开始训练

### 4️⃣ 模型评估
- 查看性能对比表
- 分析ROC曲线
- **检查过拟合程度** ⭐新功能

### 5️⃣ 可解释性分析
- **计算SHAP值** ⭐新功能
- 查看特征重要性
- 理解模型决策

### 6️⃣ 预测分析
- 输入新样本特征
- 选择模型预测
- 获取风险评级

### 7️⃣ 模型管理
- **保存最佳模型** ⭐新功能
- 查看模型列表
- 加载历史模型

---

## 💪 最佳实践

### ✅ DO (推荐)
- 使用5折交叉验证
- 选择RandomForest或XGBoost
- 监控过拟合指标
- 保存最佳模型
- 使用SHAP解释结果
- 关注交叉验证性能

### ❌ DON'T (避免)
- 仅看测试集性能
- 忽略过拟合警告
- 不做交叉验证
- 选择过多算法同时训练
- 忽略特征重要性分析

---

## 🔍 性能指标解读

### AUC (Area Under Curve)
- **> 0.9**: 优秀
- **0.8-0.9**: 良好
- **0.7-0.8**: 一般
- **< 0.7**: 需改进

### Accuracy (准确率)
- 正确预测样本 / 总样本
- 注意样本不平衡问题

### Sensitivity (灵敏度)
- 真阳性率
- 对恶性样本的识别能力

### Specificity (特异度)
- 真阴性率
- 对良性样本的识别能力

### F1-Score
- Precision 和 Recall 的调和平均
- 综合评估指标

---

## 🛠️ 故障排除速查

| 问题 | 解决方案 |
|------|----------|
| 应用无法启动 | 检查R包: `library(rBayesianOptimization)` |
| 交叉验证太慢 | 减少K折数或算法数量 |
| 内存不足 | 减少样本数或关闭贝叶斯优化 |
| 目标列错误 | 手动在UI中选择正确列 |
| SHAP计算失败 | 先训练RandomForest模型 |
| 模型保存失败 | 检查 ./saved_models/ 目录权限 |

---

## 📚 相关文档

| 文档 | 说明 |
|------|------|
| `高级版更新说明.md` | 详细功能介绍 |
| `启动高级版.txt` | 快速启动指南 |
| `R环境安装指南.md` | 环境配置 |
| `INDEX_肝癌分析模块.md` | 文档索引 |

---

## 🎯 推荐配置

### 小数据集 (<500样本)
```
训练集比例: 0.8
交叉验证: 留一法 (LOOCV)
算法: RandomForest + Logistic
贝叶斯优化: 关闭
```

### 中数据集 (500-5000样本)
```
训练集比例: 0.7
交叉验证: 5折交叉验证
算法: RandomForest + XGBoost + GBM
贝叶斯优化: 可选
```

### 大数据集 (>5000样本)
```
训练集比例: 0.7
交叉验证: 5折交叉验证 × 3重复
算法: 全部8种
贝叶斯优化: 启用 (20次迭代)
```

---

## 🎉 版本信息

- **版本**: v2.0 高级版
- **发布日期**: 2025年10月16日
- **文件**: `liver_cancer_advanced_app.R`
- **端口**: 3838
- **状态**: ✅ 运行中

---

## 🌟 关键亮点

1. 🎯 **真正的灵活性** - 任意目标列名
2. 📊 **科学的验证** - 3种交叉验证方法
3. 🔧 **智能调优** - 贝叶斯超参数优化
4. 💾 **持久化支持** - 完整的模型管理
5. ⚠️ **风险预警** - 实时过拟合检测
6. 💡 **深度理解** - SHAP可解释性分析
7. 🚀 **最新算法** - XGBoost集成

---

## 📞 快速命令参考

```bash
# 启动
cd /root/SurvivalML && R -e "shiny::runApp('liver_cancer_advanced_app.R', host='0.0.0.0', port=3838)"

# 停止
pkill -f "shiny::runApp"

# 检查状态
ps aux | grep liver_cancer_advanced

# 查看端口
netstat -tuln | grep 3838

# 查看日志
tail -f /var/log/shiny-server/*.log

# 测试连接
curl -s http://localhost:3838 | head -20
```

---

**祝您分析顺利！** 🎊

---

**最后更新**: 2025年10月16日  
**维护**: AI Assistant  
**许可**: MIT License

