# R ç¯å¢ƒå®‰è£…ä¸é…ç½®æŒ‡å—

## âš ï¸ é—®é¢˜è¯´æ˜

é”™è¯¯ä¿¡æ¯ï¼š`Cannot find R for creating R terminal. Change setting r.rterm.linux to R path.`

**åŸå› **: ç³»ç»Ÿä¸­æœªå®‰è£… R æˆ– R è·¯å¾„æœªæ­£ç¡®é…ç½®ã€‚

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: åœ¨ Linux ä¸Šå®‰è£… R (æ¨è)

#### æ­¥éª¤ 1: å®‰è£… R

```bash
# Ubuntu/Debian ç³»ç»Ÿ
sudo apt update
sudo apt install -y r-base r-base-dev

# CentOS/RHEL ç³»ç»Ÿ
sudo yum install epel-release
sudo yum install R

# éªŒè¯å®‰è£…
R --version
```

#### æ­¥éª¤ 2: å®‰è£…å¿…éœ€çš„ç³»ç»Ÿä¾èµ–

```bash
# Ubuntu/Debian
sudo apt install -y \
    libcurl4-openssl-dev \
    libssl-dev \
    libxml2-dev \
    libfontconfig1-dev \
    libharfbuzz-dev \
    libfribidi-dev \
    libfreetype6-dev \
    libpng-dev \
    libtiff5-dev \
    libjpeg-dev

# CentOS/RHEL
sudo yum install -y \
    libcurl-devel \
    openssl-devel \
    libxml2-devel \
    fontconfig-devel \
    harfbuzz-devel \
    fribidi-devel \
    freetype-devel \
    libpng-devel \
    libtiff-devel \
    libjpeg-devel
```

#### æ­¥éª¤ 3: å®‰è£… R åŒ…

```bash
# å¯åŠ¨ R
sudo R

# åœ¨ R æ§åˆ¶å°ä¸­æ‰§è¡Œ
install.packages(c(
  # æ ¸å¿ƒåŒ…
  "shiny", "shinydashboard", "shinyWidgets",
  "DT", "ggplot2", "plotly", "tidyverse",
  
  # æœºå™¨å­¦ä¹ åŒ…
  "caret", "pROC", "randomForest", "glmnet",
  "gbm", "e1071"
), repos = "https://cloud.r-project.org/")

# é€€å‡º R
quit(save = "no")
```

#### æ­¥éª¤ 4: æµ‹è¯•å®‰è£…

```bash
cd /root/SurvivalML
Rscript test_liver_cancer_module.R
```

---

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Docker (æœ€ç®€å•)

å¦‚æœæ‚¨çš„ç³»ç»Ÿæ”¯æŒ Dockerï¼Œè¿™æ˜¯æœ€å¿«çš„æ–¹å¼ã€‚

#### æ­¥éª¤ 1: åˆ›å»º Dockerfile

```bash
cd /root/SurvivalML
cat > Dockerfile << 'EOF'
FROM rocker/shiny:latest

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    libcurl4-openssl-dev \
    libssl-dev \
    libxml2-dev \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£… R åŒ…
RUN R -e "install.packages(c(\
    'shiny', 'shinydashboard', 'shinyWidgets', \
    'DT', 'ggplot2', 'plotly', 'tidyverse', \
    'caret', 'pROC', 'randomForest', 'glmnet', \
    'gbm', 'e1071' \
), repos = 'https://cloud.r-project.org/')"

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# æš´éœ²ç«¯å£
EXPOSE 3838

CMD ["R"]
EOF
```

#### æ­¥éª¤ 2: æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»º Docker é•œåƒ
docker build -t liver-cancer-analysis .

# è¿è¡Œå®¹å™¨ï¼ˆäº¤äº’å¼ï¼‰
docker run -it --rm -v $(pwd):/app liver-cancer-analysis

# æˆ–è¿è¡Œ Shiny åº”ç”¨
docker run -it --rm -p 3838:3838 \
    -v $(pwd):/app \
    liver-cancer-analysis \
    R -e "shiny::runApp('/app/liver_cancer_shiny_app.R', host='0.0.0.0', port=3838)"
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®: `http://localhost:3838`

---

### æ–¹æ¡ˆ 3: ä½¿ç”¨åœ¨çº¿ R ç¯å¢ƒ

å¦‚æœæ— æ³•åœ¨æœ¬åœ°å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨åœ¨çº¿æœåŠ¡ï¼š

#### RStudio Cloud (æ¨è)
1. è®¿é—® https://rstudio.cloud/
2. åˆ›å»ºå…è´¹è´¦æˆ·
3. åˆ›å»ºæ–°é¡¹ç›®
4. ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
5. åœ¨çº¿è¿è¡Œè„šæœ¬

#### Google Colab (R ç‰ˆæœ¬)
1. è®¿é—® https://colab.research.google.com/
2. åˆ›å»ºæ–°ç¬”è®°æœ¬
3. åˆ‡æ¢åˆ° R è¿è¡Œæ—¶
4. ä¸Šä¼ æ–‡ä»¶å¹¶è¿è¡Œ

---

### æ–¹æ¡ˆ 4: é…ç½® VS Code R æ‰©å±• (å¦‚æœä½¿ç”¨ VS Code)

#### æ­¥éª¤ 1: å®‰è£… R

å…ˆæŒ‰ç…§**æ–¹æ¡ˆ 1**å®‰è£… Rã€‚

#### æ­¥éª¤ 2: æ‰¾åˆ° R è·¯å¾„

```bash
which R
# é€šå¸¸è¾“å‡º: /usr/bin/R
```

#### æ­¥éª¤ 3: é…ç½® VS Code

åœ¨ VS Code ä¸­ï¼š

1. æ‰“å¼€è®¾ç½® (Ctrl+,)
2. æœç´¢ `r.rterm.linux`
3. è®¾ç½®å€¼ä¸º: `/usr/bin/R`

æˆ–ç›´æ¥ç¼–è¾‘ `settings.json`:

```json
{
    "r.rterm.linux": "/usr/bin/R",
    "r.rpath.linux": "/usr/bin/R",
    "r.bracketedPaste": true
}
```

#### æ­¥éª¤ 4: å®‰è£… VS Code R æ‰©å±•

1. æ‰“å¼€æ‰©å±•å¸‚åœº (Ctrl+Shift+X)
2. æœç´¢ "R" (REditorSupport.r)
3. ç‚¹å‡»å®‰è£…

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•è„šæœ¬

åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬æ¥éªŒè¯ R æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```bash
cd /root/SurvivalML
cat > test_r_installation.sh << 'EOF'
#!/bin/bash

echo "=================================="
echo "R ç¯å¢ƒæµ‹è¯•è„šæœ¬"
echo "=================================="

# æ£€æŸ¥ R æ˜¯å¦å®‰è£…
echo -e "\n[1/4] æ£€æŸ¥ R æ˜¯å¦å®‰è£…..."
if command -v R &> /dev/null; then
    echo "âœ“ R å·²å®‰è£…"
    R --version | head -1
else
    echo "âœ— R æœªå®‰è£…"
    echo "è¯·è¿è¡Œ: sudo apt install r-base r-base-dev"
    exit 1
fi

# æ£€æŸ¥ Rscript
echo -e "\n[2/4] æ£€æŸ¥ Rscript..."
if command -v Rscript &> /dev/null; then
    echo "âœ“ Rscript å¯ç”¨"
    echo "è·¯å¾„: $(which Rscript)"
else
    echo "âœ— Rscript ä¸å¯ç”¨"
    exit 1
fi

# æµ‹è¯•ç®€å•çš„ R ä»£ç 
echo -e "\n[3/4] æµ‹è¯• R ä»£ç æ‰§è¡Œ..."
Rscript -e "cat('âœ“ R ä»£ç æ‰§è¡ŒæˆåŠŸ\n')"

# æ£€æŸ¥å…³é”®åŒ…
echo -e "\n[4/4] æ£€æŸ¥ R åŒ…..."
Rscript -e "
packages <- c('shiny', 'ggplot2', 'caret')
installed <- sapply(packages, function(pkg) {
    if (requireNamespace(pkg, quietly = TRUE)) {
        cat('âœ“', pkg, '\n')
        return(TRUE)
    } else {
        cat('âœ—', pkg, '(æœªå®‰è£…)\n')
        return(FALSE)
    }
})
if (all(installed)) {
    cat('\næ‰€æœ‰å…³é”®åŒ…éƒ½å·²å®‰è£…!\n')
} else {
    cat('\néœ€è¦å®‰è£…ç¼ºå¤±çš„åŒ…ã€‚è¿è¡Œ:\n')
    cat('R -e \"install.packages(c(\\'shiny\\', \\'ggplot2\\', \\'caret\\'))\"\\n')
}
"

echo -e "\n=================================="
echo "æµ‹è¯•å®Œæˆ!"
echo "=================================="
EOF

chmod +x test_r_installation.sh
./test_r_installation.sh
```

---

## ğŸ“¦ å®Œæ•´çš„ä¸€é”®å®‰è£…è„šæœ¬

```bash
cd /root/SurvivalML
cat > install_r_environment.sh << 'EOF'
#!/bin/bash

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "=================================="
echo "R ç¯å¢ƒè‡ªåŠ¨å®‰è£…è„šæœ¬"
echo "=================================="

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
if [ -f /etc/os-release ]; then
    . /etc/os-release
    OS=$ID
else
    echo "æ— æ³•æ£€æµ‹æ“ä½œç³»ç»Ÿ"
    exit 1
fi

echo "æ£€æµ‹åˆ°æ“ä½œç³»ç»Ÿ: $OS"

# å®‰è£… R
echo -e "\n[1/3] å®‰è£… R..."
if [ "$OS" = "ubuntu" ] || [ "$OS" = "debian" ]; then
    sudo apt update
    sudo apt install -y r-base r-base-dev
    
    # å®‰è£…ç³»ç»Ÿä¾èµ–
    echo "å®‰è£…ç³»ç»Ÿä¾èµ–..."
    sudo apt install -y \
        libcurl4-openssl-dev \
        libssl-dev \
        libxml2-dev \
        libfontconfig1-dev \
        libharfbuzz-dev \
        libfribidi-dev \
        libfreetype6-dev \
        libpng-dev \
        libtiff5-dev \
        libjpeg-dev
        
elif [ "$OS" = "centos" ] || [ "$OS" = "rhel" ]; then
    sudo yum install -y epel-release
    sudo yum install -y R
    
    # å®‰è£…ç³»ç»Ÿä¾èµ–
    echo "å®‰è£…ç³»ç»Ÿä¾èµ–..."
    sudo yum install -y \
        libcurl-devel \
        openssl-devel \
        libxml2-devel
else
    echo "ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: $OS"
    exit 1
fi

echo "âœ“ R å®‰è£…å®Œæˆ"

# å®‰è£… R åŒ…
echo -e "\n[2/3] å®‰è£… R åŒ…..."
sudo R --vanilla << 'REOF'
# è®¾ç½® CRAN é•œåƒ
options(repos = c(CRAN = "https://cloud.r-project.org/"))

# å®‰è£…åŒ…
packages <- c(
  "shiny", "shinydashboard", "shinyWidgets",
  "DT", "ggplot2", "plotly", "tidyverse",
  "caret", "pROC", "randomForest", "glmnet",
  "gbm", "e1071"
)

cat("å¼€å§‹å®‰è£…", length(packages), "ä¸ª R åŒ…...\n")
install.packages(packages, dependencies = TRUE)

cat("\næ£€æŸ¥å®‰è£…ç»“æœ:\n")
for (pkg in packages) {
  if (requireNamespace(pkg, quietly = TRUE)) {
    cat("âœ“", pkg, "\n")
  } else {
    cat("âœ—", pkg, "å®‰è£…å¤±è´¥\n")
  }
}

cat("\næ‰€æœ‰ R åŒ…å®‰è£…å®Œæˆ!\n")
REOF

echo "âœ“ R åŒ…å®‰è£…å®Œæˆ"

# æµ‹è¯•å®‰è£…
echo -e "\n[3/3] æµ‹è¯•å®‰è£…..."
if [ -f "test_liver_cancer_module.R" ]; then
    Rscript test_liver_cancer_module.R
else
    echo "æµ‹è¯•è„šæœ¬ä¸å­˜åœ¨ï¼Œè·³è¿‡æµ‹è¯•"
fi

echo -e "\n=================================="
echo "âœ“ R ç¯å¢ƒå®‰è£…å®Œæˆ!"
echo "=================================="
echo ""
echo "ç°åœ¨å¯ä»¥è¿è¡Œ:"
echo "  Rscript test_liver_cancer_module.R"
echo "  shiny::runApp('liver_cancer_shiny_app.R')"
echo ""
EOF

chmod +x install_r_environment.sh
```

**è¿è¡Œå®‰è£…è„šæœ¬ï¼š**

```bash
./install_r_environment.sh
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆé€‰æ‹©

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | éš¾åº¦ | æ—¶é—´ |
|------|---------|------|------|
| é•¿æœŸä½¿ç”¨ï¼Œæœ‰ç®¡ç†å‘˜æƒé™ | **æ–¹æ¡ˆ 1** (ç›´æ¥å®‰è£…) | â­â­ | 15-30åˆ†é’Ÿ |
| ç†Ÿæ‚‰ Docker | **æ–¹æ¡ˆ 2** (Docker) | â­â­â­ | 10-20åˆ†é’Ÿ |
| æ— ç®¡ç†å‘˜æƒé™ | **æ–¹æ¡ˆ 3** (åœ¨çº¿ç¯å¢ƒ) | â­ | 5åˆ†é’Ÿ |
| ä½¿ç”¨ VS Code | **æ–¹æ¡ˆ 4** (é…ç½®æ‰©å±•) | â­â­ | 10åˆ†é’Ÿ |

---

## âœ… éªŒè¯å®‰è£…æˆåŠŸ

å®‰è£…å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
# 1. æ£€æŸ¥ R ç‰ˆæœ¬
R --version

# 2. æ£€æŸ¥ Rscript
which Rscript

# 3. è¿è¡Œæµ‹è¯•è„šæœ¬
cd /root/SurvivalML
Rscript test_liver_cancer_module.R

# 4. å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œå¯åŠ¨ Shiny åº”ç”¨
R -e "shiny::runApp('liver_cancer_shiny_app.R')"
```

å¦‚æœæ‰€æœ‰å‘½ä»¤éƒ½æˆåŠŸæ‰§è¡Œï¼Œè¯´æ˜ç¯å¢ƒé…ç½®å®Œæˆï¼

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å®‰è£…åŒ…æ—¶æç¤ºæƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ–¹æ³• 1: ä½¿ç”¨ sudo
sudo R -e "install.packages('shiny')"

# æ–¹æ³• 2: å®‰è£…åˆ°ç”¨æˆ·ç›®å½•
R -e "install.packages('shiny', lib='~/R/library')"
```

### Q2: å®‰è£…åŒ…æ—¶æŠ¥é”™ç¼ºå°‘ç³»ç»Ÿä¾èµ–

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ ¹æ®é”™è¯¯ä¿¡æ¯å®‰è£…å¯¹åº”çš„ -dev åŒ…
# ä¾‹å¦‚ç¼ºå°‘ libcurl
sudo apt install libcurl4-openssl-dev

# æˆ–æŸ¥çœ‹å®Œæ•´çš„ä¾èµ–åˆ—è¡¨
sudo apt install -y \
    libcurl4-openssl-dev \
    libssl-dev \
    libxml2-dev \
    libfontconfig1-dev
```

### Q3: Docker å®‰è£…å¾ˆæ…¢

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
# ç¼–è¾‘ /etc/docker/daemon.json
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ]
}

# é‡å¯ Docker
sudo systemctl restart docker
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. ğŸ“§ Email: liuzaoqu@163.com
2. ğŸ” æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. ğŸ“š å‚è€ƒ R å®˜æ–¹æ–‡æ¡£: https://www.r-project.org/

---

**ç¥æ‚¨å®‰è£…é¡ºåˆ©ï¼å®‰è£…å®Œæˆåå³å¯å¼€å§‹ä½¿ç”¨è‚ç™Œæ•°æ®åˆ†ææ¨¡å—ã€‚** ğŸš€

